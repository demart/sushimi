<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project activeEnvironment="Default" name="Mobizon SMS REST" soapui-version="5.1.1" abortOnError="false" runType="SEQUENTIAL" id="d4b66c6d-bc06-43ab-9036-e1cb50cb3bab" resourceRoot="" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" wadlVersion="http://wadl.dev.java.net/2009/02" name="https://mobizon.kz" type="rest" id="8e1253da-e85b-438c-952e-08012e6164f7" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>https://mobizon.kz</con:endpoint></con:endpoints><con:resource name="Get Balance" path="/service/user/getownbalance" id="d29916b4-7a5c-4a64-b9c9-f9dfc40b8f46"><con:settings/><con:parameters><con:parameter><con:name>apiKey</con:name><con:value>1234567890abcdefghit1234567890abcdefghit</con:value><con:style>QUERY</con:style><con:default>1234567890abcdefghit1234567890abcdefghit</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>output</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>api</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Getownbalance" method="GET" id="25f48dff-93fb-4de5-9409-81960da90b5f"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>text/javascript;</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:get="https://mobizon.kz/service/user/getownbalance">get:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>text/xml;</con:mediaType><con:status>200</con:status><con:params/><con:element>root</con:element></con:representation><con:request name="Request 1" mediaType="application/json" id="dc71fade-7347-49a4-a6e5-5cac48f3d0d4"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/user/getownbalance</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="api" value="v1"/>
  <con:entry key="output" value="json"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>output</con:entry><con:entry>api</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="Send SMS Message" path="/service/message/sendsmsmessage" id="d5114caa-28c3-4dc5-9ca5-5dec3a244f4a"><con:settings/><con:parameters><con:parameter><con:name>apiKey</con:name><con:value>KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK</con:value><con:style>QUERY</con:style><con:default>KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK</con:default></con:parameter><con:parameter><con:name>recipient</con:name><con:value>NNNNNNNNNNN</con:value><con:style>QUERY</con:style><con:default>NNNNNNNNNNN</con:default></con:parameter><con:parameter><con:name>text</con:name><con:value>Текст сообщения</con:value><con:style>QUERY</con:style><con:default>Текст сообщения</con:default></con:parameter><con:parameter><con:name>output</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>api</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>ttl</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="Method 1" method="GET" id="0eab45bb-c5b3-477b-a7cf-2568280d3717"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>text/javascript;</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:sen="https://mobizon.kz/service/message/sendsmsmessage">sen:Response</con:element></con:representation><con:request name="Artem" mediaType="application/json" id="ea848720-9f08-4ac1-9bdd-c2a9a05ccd58"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="text" value="Привет это сушими тебя беспокоит"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="ttl" value="120"/>
  <con:entry key="output" value="json"/>
  <con:entry key="recipient" value="77015515101"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request><con:request name="Misha" mediaType="application/json" id="65b53201-1217-49df-b5ff-0a3224c30600"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="text" value="Привет Михаил Сушими верит в тебя!"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="output" value="json"/>
  <con:entry key="ttl" value="120"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
  <con:entry key="recipient" value="77013273441"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request><con:request name="Alimzhan" mediaType="application/json" id="7da730d7-00bd-452a-bae3-44b7a9714004"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="text" value="Привет Алимжан, тысячи андроидолюбов ждут твоего приложения!"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="ttl" value="120"/>
  <con:entry key="output" value="json"/>
  <con:entry key="recipient" value="77051948785"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request><con:request name="Denis Krylov" mediaType="application/json" id="cc71590a-47a0-4add-a41c-95a6763b260d"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="text" value="Привет Денис, Сушими следит за тобой"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="output" value="json"/>
  <con:entry key="ttl" value="120"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
  <con:entry key="recipient" value="77071011147"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request><con:request name="Nadezhda" mediaType="application/json" id="76f9c2ea-7387-4647-8f25-d582fe22a5f5"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="text" value="Мася, больше не уводи мою ID карту"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="ttl" value="20"/>
  <con:entry key="output" value="json"/>
  <con:entry key="recipient" value="77014130715"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request><con:request name="Common" mediaType="application/json" id="ea848720-9f08-4ac1-9bdd-c2a9a05ccd58"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="output" value="json"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="ttl" value="120"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:request></con:method></con:resource><con:resource name="Get SMS Status" path="/service/message/getsmsstatus" id="5834578e-226d-41a7-97df-973ff61da69e"><con:settings/><con:parameters><con:parameter><con:name>apiKey</con:name><con:value>1</con:value><con:style>QUERY</con:style><con:default>1</con:default></con:parameter><con:parameter><con:name>ids</con:name><con:value>559204</con:value><con:style>QUERY</con:style><con:default>559204</con:default></con:parameter><con:parameter><con:name>output</con:name><con:value>json</con:value><con:style>QUERY</con:style><con:default>json</con:default></con:parameter><con:parameter><con:name>api</con:name><con:value>v1</con:value><con:style>QUERY</con:style><con:default>v1</con:default></con:parameter></con:parameters><con:method name="Method 1" method="GET" id="250f3284-60ca-4522-979c-b52acc9a5ca7"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json;</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:get="https://mobizon.kz/service/message/getsmsstatus">get:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>text/javascript;</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:get="https://mobizon.kz/service/message/getsmsstatus">get:Response</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" mediaType="application/json" id="4cd3587f-8dea-4c71-9045-8f95ebd10f37"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/getsmsstatus</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="ids" value="559713"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
</con:parameters></con:request></con:method></con:resource></con:interface><con:testSuite name="Broadcast" id="16a52683-5d31-4768-a542-f1a8628da9fe"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Broadcast_1" searchProperties="true" id="1766bb68-9e01-4757-9fd1-8a7df9107164"><con:settings/><con:testStep type="properties" name="Properties" id="95f4b25a-d041-4679-953b-1b5b3b2622ce"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>limit</con:name><con:value>400</con:value></con:property><con:property><con:name>offset</con:name><con:value>401</con:value></con:property><con:property><con:name>sentCount</con:name><con:value>400</con:value></con:property><con:property><con:name>message</con:name><con:value>Sushimi.kz новое меню и снижение цен. При заказе от 4000 подарки!</con:value></con:property><con:property><con:name>addresseeCount</con:name><con:value>400</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Convert String to Integer" id="55ad881c-6e26-4671-ac59-a8c4a640d656" disabled="true"><con:settings/><con:config><script>def limit = context.expand( '${Properties#limit}' )
def offset = context.expand( '${Properties#offset}' )
testRunner.testCase.testSteps["JDBC Fetch Addresses"].setPropertyValue("limit", limit.toInteger())
testRunner.testCase.testSteps["JDBC Fetch Addresses"].setPropertyValue("offset", offset.toInteger())</script></con:config></con:testStep><con:testStep type="jdbc" name="JDBC Fetch Addresses" id="bb992f8d-c037-4d85-a3e5-26af5230c545"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName>postgres_sushimi_console_sms</con:dbConnectionName><con:driver>org.postgresql.Driver</con:driver><con:connectionString>jdbc:postgresql://127.0.0.1:5432/sushimi-console-last?user=postgres&amp;password=PASS_VALUE</con:connectionString><con:password>postgres</con:password><con:query>Select distinct 
  public.client_sms.phonenumber as phone
From public.client_sms
 limit CAST(:limit AS integer)  offset CAST(:offset AS integer)</con:query><con:properties><con:property><con:name>limit</con:name><con:value>${Properties#limit}</con:value></con:property><con:property><con:name>offset</con:name><con:value>${Properties#offset}</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="groovy" name="Retrieved records" id="7d3a1baa-82d0-422c-9c2b-6fbdf005dfe4"><con:settings/><con:config><script>// total addressee count
testRunner.testCase.testSteps["Properties"].setPropertyValue("sentCount", "0")
def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )
def holder = groovyUtils.getXmlHolder("JDBC Fetch Addresses#ResponseAsXml")
def cnt = holder["count(//Results/ResultSet/Row)"];
testRunner.testCase.testSteps["Properties"].setPropertyValue("addresseeCount", cnt.toString())
log.info("Broadcast successfully fetched from addressee list " + cnt + " records")
log.info("Broadcast is going to start sending messages...")
def message = context.expand( '${Properties#message}' )
log.info("Broadcast messages: " + message)



//def row = context.expand( '${JDBC Fetch Addresses#ResponseAsXml#//Results[1]/ResultSet[1]}' )
//def phone = context.expand( '${JDBC Fetch Addresses#ResponseAsXml#//Results[1]/ResultSet[1]/Row[1]/PHONE[1]}' )
//log.info(cnt)
//log.info(row)
//log.info(phone)</script></con:config></con:testStep><con:testStep type="datasource" name="addresseeDataSource" id="dc33f49a-2e71-4775-be8e-642db032bccd"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.teststeps.WsdlDataSourceTestStep@prepared-properties">&lt;xml-fragment/></con:setting></con:settings><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="XML"><con:configuration><sourceStep>JDBC Fetch Addresses</sourceStep><sourceProperty>ResponseAsXml</sourceProperty><rowPath>//Results[1]/ResultSet[1]/Row</rowPath><columnPath>ID[1]</columnPath><columnPath>NAME[1]</columnPath><columnPath>PHONE[1]</columnPath></con:configuration></con:dataSource><con:property>id</con:property><con:property>name</con:property><con:property>phone</con:property><con:restartOnRun>true</con:restartOnRun></con:config></con:testStep><con:testStep type="groovy" name="prepareForSendingSmsToAddressee" id="4b34d855-0a5f-4fc7-b3cb-c53decb4d171"><con:settings/><con:config><script>def sentCount = context.expand( '${Properties#sentCount}' ).toInteger()
sentCount = sentCount + 1;
testRunner.testCase.testSteps["Properties"].setPropertyValue("sentCount", sentCount.toString())
//def id = context.expand( '${addresseeDataSource#id}' )
//def name = context.expand( '${addresseeDataSource#name}' )
def phone = context.expand( '${addresseeDataSource#phone}' )
phone= "7" + phone 
//log.info("Sending message to user:" + id + " name:" + name + " phone:" + phone)
log.info("Sending message to phone:" + phone)</script></con:config></con:testStep><con:testStep type="restrequest" name="Send sms to addressee" id="78aab994-4718-475d-b5de-776db7433400"><con:settings/><con:config service="https://mobizon.kz" resourcePath="/service/message/sendsmsmessage" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Send sms to addressee" mediaType="application/json" id="ea848720-9f08-4ac1-9bdd-c2a9a05ccd58"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/sendsmsmessage</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="output" value="json"/>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
  <con:entry key="recipient" value="7${addresseeDataSource#phone}"/>
  <con:entry key="api" value="v1"/>
  <con:entry key="text" value="${Properties#message}"/>
  <con:entry key="ttl" value="120"/>
</con:parameters><con:parameterOrder><con:entry>apiKey</con:entry><con:entry>recipient</con:entry><con:entry>text</con:entry><con:entry>output</con:entry><con:entry>api</con:entry><con:entry>ttl</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="delay" name="waitForSentStatus" id="9d287fee-f675-43c1-b25c-11c564a40409"><con:settings/><con:config><delay>2000</delay></con:config></con:testStep><con:testStep type="restrequest" name="checkSentStatus" id="d057f6ba-2d82-4bb9-a30b-f58f02814b3a"><con:settings/><con:config service="https://mobizon.kz" resourcePath="/service/message/getsmsstatus" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="checkSentStatus" mediaType="application/json" id="4cd3587f-8dea-4c71-9045-8f95ebd10f37"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://mobizon.kz</con:endpoint><con:request/><con:originalUri>https://mobizon.kz/service/message/getsmsstatus</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="apiKey" value="bc6d40cf999a402c4f9d4ac245e396af78635ef7"/>
  <con:entry key="ids" value="${Send sms to addressee#ResponseAsXml#declare namespace ns1='https://mobizon.kz/service/message/sendsmsmessage'; //ns1:Response[1]/ns1:data[1]/ns1:messageId[1]}"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="isMessageSent" id="fb3f0ff9-caf2-490a-b5c8-436a268b3690"><con:settings/><con:config><script>def status = context.expand( '${checkSentStatus#ResponseAsXml#declare namespace ns1=\'https://mobizon.kz/service/message/getsmsstatus\'; //ns1:Response[1]/ns1:data[1]/ns1:e[1]/ns1:status[1]}' )

if (status == "NEW") {
	log.info("Message status: " + status) 
	testRunner.gotoStepByName( "gotoNextAddressee")
	//testRunner.gotoStepByName( "waitForSentStatus")
	return;
}

if (status == "ENQUEUD") {
	log.info("Message status: " + status) 
	testRunner.gotoStepByName( "gotoNextAddressee")
//	testRunner.gotoStepByName( "waitForSentStatus")
	return;
}

if (status == "ACCEPTD") {
	log.info("Message status: " + status) 
	testRunner.gotoStepByName( "gotoNextAddressee")
	//testRunner.gotoStepByName( "waitForSentStatus")
	return;
}

if (status == "PDLIVRD") {
	log.info("Message status: " + status) 
	testRunner.gotoStepByName( "gotoNextAddressee")
	//testRunner.gotoStepByName( "waitForSentStatus")	
	return;
}

if (status == "UNDELIV") {
	log.info("Message status: " + status)
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;
}

if (status == "REJECTD") {
	log.info("Message status: " + status) 
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;
}

if (status == "DELIVRD") {
	log.info("Message status: " + status)
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;
}

if (status == "EXPIRED") {
	log.info("Message status: " + status)
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;
}

if (status == "DELETED")  {
	log.info("Message status: " + status)
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;	
} else {
	log.info("Message status: " + status)
	testRunner.gotoStepByName( "gotoNextAddressee")
	return;
}

	/*
	 * 
NEW	нет	Новое сообщение, еще не было отправлено
ENQUEUD	нет	Прошло модерацию и поставлено в очередь на отправку
ACCEPTD	нет	Отправлено из системы и принято оператором для дальнейшей пересылки получателю
UNDELIV	да	Не доставлено получателю
REJECTD	да	Отклонено оператором по одной из множества причин - неверный номер получателя, запрещенный текст и т.д.
PDLIVRD	нет	Не все сегменты сообщения доставлены получателю, некоторые операторы возвращают отчет только о первом доставленном сегменте, поэтому такое сообщение после истечения срока жизни перейдет в статус DELIVRD
DELIVRD	да	Доставлено получателю полностью
EXPIRED	да	Доставка не удалась так как истек срок жизни сообщения (по умолчанию 3 суток)
DELETED	да	Удалено из-за ограничений и не доставлено до получателя
	 * 
	 * 
	 * 
	 */</script></con:config></con:testStep><con:testStep type="datasourceloop" name="gotoNextAddressee" id="ca40bddb-1c9a-4f2a-9140-d33a800c25fa"><con:settings/><con:config><dataSourceStep>addresseeDataSource</dataSourceStep><targetStep>prepareForSendingSmsToAddressee</targetStep></con:config></con:testStep><con:testStep type="groovy" name="showFinalReport" id="09efe0a4-f109-4c31-9344-68180832dfc3"><con:settings/><con:config><script>log.info("Broadcast successfully finished...")</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>55ad881c-6e26-4671-ac59-a8c4a640d656</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase id="bcd367fb-c504-4550-88a9-3683ca672c60" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Import Lombard Clients" searchProperties="true"><con:settings/><con:testStep type="datasource" name="Excell File" id="b6aa218a-54b9-4fff-97e8-f4932609ff9f"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>/Users/artem.demidovich/Documents/sushimi/backups/lombard_clients_january_2016.xlsx</file><worksheet/><cell>A1</cell><ignoreEmpty>false</ignoreEmpty></con:configuration></con:dataSource><con:property>name</con:property><con:property>phone</con:property><con:restartOnRun>true</con:restartOnRun></con:config></con:testStep><con:testStep type="datasink" name="DataSink" id="1a12f5b6-e466-4357-a29a-186605658f1e"><con:settings/><con:config xsi:type="con:DataSinkStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSink type="JDBC"><con:configuration><driver>org.postgresql.Driver</driver><connstr>jdbc:postgresql://127.0.0.1:5432/sushimi-console-last?user=postgres&amp;password=PASS_VALUE</connstr><pass>postgres</pass><query>insert into broadcast_clients(client_name,client_phone, source) values (?,?,'lombard');</query><stored-procedure>false</stored-procedure></con:configuration></con:dataSink><con:properties><con:property><con:name>client_name</con:name><con:value>${Excell File#name}</con:value></con:property><con:property><con:name>client_phone</con:name><con:value>${Excell File#phone}</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="datasourceloop" name="DataSource Loop" id="21d6bc7e-b27b-43e1-8f02-c0a303266ccf"><con:settings/><con:config><dataSourceStep>Excell File</dataSourceStep><targetStep>DataSink</targetStep></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>21d6bc7e-b27b-43e1-8f02-c0a303266ccf</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:requirements/><con:properties/><con:wssContainer/><con:databaseConnectionContainer><con:databaseConnection><con:name>postgres_sushimi_console_sms</con:name><con:driver>org.postgresql.Driver</con:driver><con:connectionString>jdbc:postgresql://127.0.0.1:5432/sushimi-console-last?user=postgres&amp;password=PASS_VALUE</con:connectionString><con:password>postgres</con:password></con:databaseConnection></con:databaseConnectionContainer><con:oAuth2ProfileContainer/><con:reporting><con:xmlTemplates/><con:parameters/></con:reporting></con:soapui-project>